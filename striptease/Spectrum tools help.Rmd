---
jupyter:
  jupytext:
    formats: ipynb,Rmd
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.4.1
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

# Import and functions

```{python}
import spectrum
import numpy as np
import pylab as pl
from importlib import reload
import pdb
reload(spectrum)
```

# Test with white noise data stream


## Noise generation

```{python}
sigma = 2.
mean = 0.
n_elements = 1000000
noise = np.random.normal(mean, sigma, n_elements)
```

```{python}
pl.plot(noise)
```

## Calculate spectrum and white noise level

```{python}
reload(spectrum)
```

```{python}
# Create instance to the class
spec_inst = spectrum.Spectrum()
```

```{python}
# Print parameters
spec_inst.parameters()
```

### No windowing

```{python}
# Set sampling frequency
samp_freq = 1.5 #Hz
```

```{python}
# Calculate amplitude spectrum and check white noise level
spec_inst.spectrum_type[0] = 'AS'
spec = spec_inst.spectrum(noise,samp_freq)
wnl = spec_inst.white_noise_level(spec)
pl.plot(spec['frequencies'],spec['amplitudes'])
print('White noise level from spectrum = %4.3f, '
      'standard deviation = %4.3f' % (wnl, np.std(noise)))
```

```{python}
# Calculate amplitude spectral density and check white noise level
spec_inst.spectrum_type[0] = 'ASD'
spec = spec_inst.spectrum(noise,samp_freq)
wnl = spec_inst.white_noise_level(spec)
pl.plot(spec['frequencies'],spec['amplitudes'])
print('White noise level from spectrum = %4.3f, '
      'standard deviation = %4.3f' % (wnl*np.sqrt(samp_freq), np.std(noise)))
```

```{python}
# Calculate power spectrum and check white noise level
spec_inst.spectrum_type[0] = 'PS'
spec = spec_inst.spectrum(noise,samp_freq)
wnl = spec_inst.white_noise_level(spec)
pl.plot(spec['frequencies'],spec['amplitudes'])
print('White noise level from spectrum = %4.3f, '
      'variance = %4.3f' % (wnl, np.std(noise)**2))
```

```{python}
# Calculate power spectral density and check white noise level
spec_inst.spectrum_type[0] = 'PSD'
spec = spec_inst.spectrum(noise,samp_freq)
wnl = spec_inst.white_noise_level(spec)
pl.plot(spec['frequencies'],spec['amplitudes'])
print('White noise level from spectrum = %4.3f, '
      'variance = %4.3f' % (wnl*samp_freq, np.std(noise)**2))
```

### With windowing

```{python}
# Set sampling frequency
samp_freq = 1.5 #Hz

# Set windowing and lowest freq
spec_inst.welch[0] = True
spec_inst.lowfreq[0] = 1.e-3
```

```{python}
# Calculate amplitude spectrum and check white noise level
spec_inst.spectrum_type[0] = 'AS'
spec = spec_inst.spectrum(noise,samp_freq)
wnl = spec_inst.white_noise_level(spec)
pl.plot(spec['frequencies'],spec['amplitudes'])
print('White noise level from spectrum = %4.3f, '
      'standard deviation = %4.3f' % (wnl, np.std(noise)))
```

```{python}
# Calculate amplitude spectral density and check white noise level
spec_inst.spectrum_type[0] = 'ASD'
spec = spec_inst.spectrum(noise,samp_freq)
wnl = spec_inst.white_noise_level(spec)
pl.plot(spec['frequencies'],spec['amplitudes'])
print('White noise level from spectrum = %4.3f, '
      'standard deviation = %4.3f' % (wnl*np.sqrt(samp_freq), np.std(noise)))
```

```{python}
# Calculate power spectrum and check white noise level
spec_inst.spectrum_type[0] = 'PS'
spec = spec_inst.spectrum(noise,samp_freq)
wnl = spec_inst.white_noise_level(spec)
pl.plot(spec['frequencies'],spec['amplitudes'])
print('White noise level from spectrum = %4.3f, '
      'standard deviation = %4.3f' % (wnl, np.std(noise)**2))
```

```{python}
# Calculate power spectral density and check white noise level
spec_inst.spectrum_type[0] = 'PSD'
spec = spec_inst.spectrum(noise,samp_freq)
wnl = spec_inst.white_noise_level(spec)
pl.plot(spec['frequencies'],spec['amplitudes'])
print('White noise level from spectrum = %4.3f, '
      'standard deviation = %4.3f' % (wnl*samp_freq, np.std(noise)**2))
```

# Test with white noise + 1/f


## Generate noise

```{python}
import noise_generator
reload(noise_generator)
```

```{python}
noisegen = noise_generator.NoiseGenerator()
```

```{python}
noisegen.parameters()
```

```{python}
fr = 30
bw = 6
Ts = 10
Tn = 10
sl = -1.5
fs = 1.
tl = 10**6
noisegen.A[0] = 1.e-7
noisegen.add_offset[0] = False
noisegen.wn_only[0] = False
noisegen.total_power[0] = True
```

```{python}
noise = noisegen.generate_noise(fr,bw,[Ts,Tn],sl,fs,tl)
```

```{python}
pl.plot(noise)
```

```{python}
fr = 30
bw = 6
wn = 0.01
fk = 1e-2
sl = -1.
fs = 1.
tl = 10**6
noisegen.A[0] = 1.e-7
noisegen.add_offset[0] = False
noisegen.wn_only[0] = False
noisegen.total_power[0] = False
```

```{python}
noise = noisegen.generate_noise(fr,bw,[wn,fk],sl,fs,tl)
```

```{python}
pl.plot(noise)
```

```{python}
# Create instance to the class
spec_inst = spectrum.Spectrum()

# Set sampling frequency
samp_freq = 1. #Hz

# Calculate amplitude spectrum and check white noise level
spec_inst.spectrum_type[0] = 'PS'
spec_inst.welch[0] = True
spec_inst.lowfreq[0] = 1e-4
spec = spec_inst.spectrum(noise,samp_freq)

wnl = spec_inst.white_noise_level(spec)

pl.loglog(spec['frequencies'],spec['amplitudes'])
print('White noise level from spectrum = %4.3f, '
      'standard deviation = %4.3f' % (wnl, np.std(noise)))
```

```{python}
spec['amplitudes']
```

```{python}
a = np.abs(np.fft.fft(noise))
```

```{python}
pl.plot(a)
```

```{python}

```
